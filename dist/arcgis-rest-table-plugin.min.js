"use strict";$.fn.extend({sortableTable:function sortableTable(a){var b=document.createElement("style");b.innerHTML="\n        @import url(\"https://fonts.googleapis.com/css?family=Source+Sans+Pro\"); \n        @import url(\"https://fonts.googleapis.com/icon?family=Material+Icons\");\n        .action-menu ul li .material-icons {\n            float: right;\n            position: relative;\n            bottom: -2px;\n            font-size: 16px;\n        }\n        ",document.head.appendChild(b);var c,d=[],e={"sort-bar":{padding:"8px","border-spacing":"7px","-webkit-border-horizontal-spacing":"5px","-webkit-border-vertical-spacing":"5px",margin:" 0 5px 0 5px","text-align":"right","z-index":1e3},"sort-bar-text":{"vertical-align":"top","margin-right":"2px","font-size":"15px",cursor:"pointer"},"action-menu":{position:"absolute",top:"2px",right:"9px","box-shadow":"#888 0 0 1px 1px",background:"white",display:"none",cursor:"pointer","font-size":"12px","text-align":"left","max-height":"272px","overflow-y":"auto"},"action-menu-ul":{margin:0,padding:0,border:0,"font-size":"100%",font:"inherit","vertical-align":"baseline","list-style":"none"},"action-menu-li":{"background-color":"#FFF",position:"relative",padding:"10px"},"action-menu-material-icons":{float:"right",position:"relative",bottom:"-2px"},"action-menu-input":{display:"none"},"action-menu-second":{right:"69px"},"action-menu-label":{display:"block",width:"100%"},"list-header":{"font-size":"14px"},"yellow-list-table":{width:"100%","text-align":"left","overflow-y":"auto","border-spacing":"5px"},"yellow-list-table-th":{width:"100%","text-align":"center"},"yellow-list-table-td":{"border-left":"4px solid #FFC107","box-shadow":"rgba(158, 158, 158, 0.42) 0px 0px 0px 1px",padding:"8px",cursor:"pointer"},"yellow-list-table-td:hover":{"border-left":"4px solid #FFC107","box-shadow":"rgba(158, 158, 158, 0.42) 0px 0px 0px 1px",padding:"8px",cursor:"pointer",background:"#FFC107"},"yellow-list-material-icons-action":{float:"right"}},f={addTable:function addTable(b,a,g,h,i){var j="table"+(100*Math.random()).toFixed(0);if($(b).show(),c=$(b).html(),-1===$(b).html().indexOf("<table")){var k=function(a){for(var b=a.features,c=0;c<b.length;c++)d.push({Name:b[c].attributes[g],Type:b[c].attributes[h],Geometry:b[c].geometry});l(d)},l=function(c){$("#"+j+" tr").remove(),$("#"+j).append("<tr></tr>");for(var a=0;a<c.length;a++){var b=c[a].Name.toString(),d=c[a].Type,f=JSON.stringify(c[a].Geometry);d?$("#"+j+" tr:last").after("<tr id=\""+b.substring(0,3)+j+"\" class=\" even\"><td><span class=\"list-header\">"+b+"</span><br><text class=\"cat\">"+d+"</text><i class=\"material-icons action\">search</i></td></tr>"):$("#"+j+" tr:last").after("<tr id=\""+b.substring(0,3)+j+"\" class=\"even\"><td><span class=\"list-header\">"+b+"</span><i class=\"material-icons action\">search</i></td></tr>")}$("#"+j+" .list-header").css(e["list-header"]),$("table.yellow-list td").css(e["yellow-list-table-td"]),$("table.yellow-list .material-icons.action").css(e["yellow-list-material-icons-action"]),$("#"+j+" td").each(function(d,a){var b=c[d].Geometry;$(a).on("click",function(){"polygon"===b.type?map.setExtent(b.getExtent()):map.centerAndZoom(b,18)})})};$(b).append("<table class=\"yellow-list\" id=\""+j+"\"><tbody id=\"fbody\"><tr></tr> </tbody></table>"),$("table.yellow-list").css(e["yellow-list-table"]),require(["esri/tasks/query","esri/tasks/QueryTask"],function(b,c){var d=new c(a),e=new b;e.where="0=0",e.returnGeometry=!0,e.outFields=h?[g,h]:[g],d.execute(e,k)})}f.addSortBar("#"+j,h,i)},addSortBar:function addSortBar(b,a,c){console.log(b);var d=$(b);if($("#"+d[0].id+" tbody tr").first().before("<div class=\"sort-bar\" ><label style=\"float: left;display:none\" id=\"backArrow\"><i class=\"material-icons\" style=\"font-size:18px;cursor:pointer;\">arrow_back</i><text> back</text></label><label id=\"sortDiv\" style=\"display:none\"><text>Filter</text><i class=\"material-icons\" style = \"padding-right: 5px; font-size:18px;cursor:pointer; vertical-align: middle\">sort</i></label><label  style=\"padding-left:10px\"><text>Sort</text><i class=\"material-icons\" style=\"font-size:18px;cursor:pointer; vertical-align: middle\">sort_by_alpha</i></label></div>"),d.append("<div class=\"sortMenu action-menu\"><ul><li>Ascending<i class=\"material-icons\" id=\"AscBtn\">radio_button_checked</i></li><li>Descending<i class=\"material-icons\" id=\"DscBtn\">radio_button_unchecked</i></li></ul></div><div id=\"sortBar"+b.substring(1,9)+"\" class=\"filterMenu action-menu second\"><ul></ul></div>"),!0===c){var g=$("#"+d[0].id+" #backArrow");g.show(),g.on("click",function(){f.back(b)})}if(a){var h=$("#"+d[0].id+" #sortDiv");h.show(),h.on("click",function(){f.filterMenu(event,b)})}return $("#"+d[0].id+" .sortMenu li").first().on("click",$.proxy(function(){f.sortTable(d,"asc")})),$("#"+d[0].id+" .sortMenu li").last().on("click",$.proxy(function(){f.sortTable(d,"desc")})),$("#"+d[0].id+" .sort-bar label").last().on("click",$.proxy(function(){f.sortMenu(event,b)})),$("div.sort-bar").css(e["sort-bar"]),$("sort-bar text").css(e["sort-bar-text"]),$(".action-menu.second").css(e["action-menu-second"]),$("div.sortMenu.action-menu").css(e["action-menu"]),$("div.sortMenu.action-menu ul").css(e["action-menu-ul"]),$("div.sortMenu.action-menu li").css(e["action-menu-li"]),$("div.sortMenu.action-menu").css("width","100px"),$("div.filterMenu.action-menu").css(e["action-menu"]),$("div.filterMenu.action-menu ul").css(e["action-menu-ul"]),$("div.filterMenu.action-menu li").css(e["action-menu-li"]),$(".action-menu .material-icons").css(e["action-menu-material-icons"]),d},listCheck:function(a){a=a.children[0].children[0],!0==a.checked?(a.parentElement.children.RadioBtn.innerHTML="radio_button_checked",a.checked=!0):(a.parentElement.children.RadioBtn.innerHTML="radio_button_unchecked",a.checked=!1),f.filterTable()},sortTable:function sortTable(a,c){a=$(a);var b=a.find("tbody");b.find("tr").sort(function(d,a){return"asc"===c?($("#AscBtn").html("radio_button_checked"),$("#DscBtn").html("radio_button_unchecked"),$("#sortMenu").hide(),$("td:first",d).text().localeCompare($("td:first",a).text())):($("#AscBtn").html("radio_button_unchecked"),$("#DscBtn").html("radio_button_checked"),$("#sortMenu").hide(),$("td:first",a).text().localeCompare($("td:first",d).text()))}).appendTo(b)},filterTable:function filterTable(){var c=[];$(".filterMenu li label span").each(function(d,a){!0==a.parentElement.children[0].checked&&c.push(a.innerText)}),$("#fbody tr td .cat").each(function(d,a){a.parentElement.parentElement.style.display=-1==c.indexOf(a.innerText)?"none":"table-row"})},filterMenu:function filterMenu(b,c){var g=c;if(isNaN($(g).parent().css("top")[0])?$(g+" .filterMenu").show().css({top:b.clientY-66,left:b.pageX-"300px"}):$(g+" .filterMenu").show().css({top:"2px",left:b.pageX-"300px"}),!$(g+"> div.action-menu.filterMenu.second > ul > li")[0]){var i=function(b){for(var c=$(g+" .filterMenu ul"),d=[],a=0;a<b.length;a++)-1==d.indexOf(b[a])&&(d.push(b[a]),c.append("<li><label><input type=\"checkbox\" checked><span>"+d[a]+"</span><i class=\"material-icons\" id=\"RadioBtn\">radio_button_checked</i></label></li>"),c.children("li").last().on("click",$.proxy(function(){f.listCheck(this)})))};Array.prototype.filter=function(a){for(var b={},c=[],d=0;d<this.length;d++)b[this[d][a]]||(b[this[d][a]]=!0,c.push(this[d][a]));return c.splice(c.indexOf(null),1),c.sort(),c};var a=[];a=d.filter("Type");for(var h=0,j=0;j<a.length;j++)a[j].length>h&&(h=a[j].length);$(g+" .filterMenu").css("width",7*h+35),i(a),$("div.filterMenu.action-menu ul").css(e["action-menu-ul"]),$("div.filterMenu.action-menu li").css(e["action-menu-li"]),$(".action-menu .material-icons").css(e["action-menu-material-icons"]),$(".action-menu input").css(e["action-menu-input"])}$("div.filterMenu.action-menu li").css(e["action-menu-li"]),setTimeout(function(){$(document).on("click",f.filterOff)},200)},sortMenu:function sortMenu(b,c){$(c+" .sortMenu").show();var a=c;isNaN($(a).parent().css("top")[0])?$(a+" .sortMenu").show().css({top:b.clientY-66,left:b.pageX-"150px"}):$(a+" .sortMenu").show().css({top:"2px",left:b.pageX-"150px"}),setTimeout(function(){$(document).on("click",f.sortOff)},200)},filterOff:function filterOff(a){!$(a.target).closest(".filterMenu").length&&$(".filterMenu").is(":visible")&&($(".filterMenu").hide(),$(document).off("click",f.filterOff))},sortOff:function sortOff(a){!$(a.target).closest(".sortMenu").length&&$(".sortMenu").is(":visible")&&($(".sortMenu").hide(),$(document).off("click",f.sortOff))},back:function back(b){$(b).parent().hide(),$(b).parent().html("")}};f.addTable.apply(null,[this,a.url,a.nameField,a.sortField,a.back])}});
